<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NES Game Emulator - Nostalgist.js</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: #222;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .controls-section {
            padding: 20px;
            background: #2a2a2a;
            border-bottom: 2px solid #444;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .control-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        label {
            color: #ddd;
            font-size: 14px;
            font-weight: 600;
            min-width: 120px;
        }

        input[type="file"],
        input[type="text"] {
            padding: 10px 12px;
            border: 2px solid #444;
            border-radius: 6px;
            background: #333;
            color: #fff;
            font-size: 14px;
            flex: 1;
            min-width: 200px;
            cursor: pointer;
        }

        input[type="file"]::file-selector-button {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        input[type="file"]::file-selector-button:hover {
            background: #5568d3;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        .btn-primary {
            background: #667eea;
            flex: 1;
            min-width: 150px;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background: #999;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #764ba2;
            min-width: 120px;
        }

        .btn-secondary:hover {
            background: #653a8a;
        }

        .btn-secondary:disabled {
            background: #999;
            cursor: not-allowed;
        }

        .emulator-section {
            padding: 20px;
            background: #1a1a1a;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }

        #nostalgist-container {
            width: 100%;
            max-width: 100%;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        #nostalgist-container canvas {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 8px;
        }

        .status-message {
            color: #ddd;
            padding: 20px;
            text-align: center;
            font-size: 16px;
        }

        .info-section {
            padding: 20px;
            background: #2a2a2a;
            border-top: 2px solid #444;
            color: #ddd;
            font-size: 13px;
            line-height: 1.6;
        }

        .info-section h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .keyboard-controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
            font-size: 12px;
        }

        .control-item {
            background: #333;
            padding: 8px;
            border-radius: 4px;
        }

        .control-item strong {
            color: #667eea;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 24px;
            }

            .control-row {
                flex-direction: column;
            }

            label {
                min-width: auto;
                width: 100%;
            }

            input[type="file"],
            input[type="text"] {
                min-width: auto;
                width: 100%;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            .emulator-section {
                min-height: 300px;
            }

            .keyboard-controls {
                grid-template-columns: 1fr;
            }
        }

        .loading {
            text-align: center;
            color: #667eea;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-left: 10px;
            border: 3px solid #667eea;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üéÆ NES Game Emulator</h1>
            <p>Ch∆°i game NES c·ªï ƒëi·ªÉn tr·ª±c ti·∫øp tr√™n tr√¨nh duy·ªát c·ªßa b·∫°n</p>
        </div>

        <!-- Controls Section -->
        <div class="controls-section">
            <div class="control-group">
                <!-- ROM Input Options -->
                <div class="control-row">
                    <label>üìÅ Ch·ªçn ROM t·ª´ m√°y:</label>
                    <input type="file" id="romFile" accept=".nes" />
                </div>

                <div class="control-row">
                    <label>üîó Ho·∫∑c nh·∫≠p URL ROM:</label>
                    <input type="text" id="romUrl" placeholder="https://example.com/game.nes" />
                </div>

                <!-- Action Buttons -->
                <div class="button-group">
                    <button class="btn-primary" id="playButton" onclick="handlePlayRom()">
                        ‚ñ∂ Ch∆°i Game
                    </button>
                    <button class="btn-secondary" id="pauseButton" onclick="handlePause()" disabled>
                        ‚è∏ T·∫°m d·ª´ng
                    </button>
                    <button class="btn-secondary" id="resumeButton" onclick="handleResume()" disabled>
                        ‚ñ∂Ô∏è Ti·∫øp t·ª•c
                    </button>
                    <button class="btn-secondary" id="stopButton" onclick="handleStop()" disabled>
                        ‚èπ D·ª´ng
                    </button>
                </div>
            </div>
        </div>

        <!-- Emulator Display -->
        <div class="emulator-section">
            <div id="nostalgist-container" style="display: none;"></div>
            <div id="status" class="status-message">
                Ch·ªçn m·ªôt file NES ho·∫∑c nh·∫≠p URL ƒë·ªÉ b·∫Øt ƒë·∫ßu ch∆°i game
            </div>
        </div>

        <!-- Info Section -->
        <div class="info-section">
            <h3>üìñ H∆∞·ªõng d·∫´n ƒëi·ªÅu khi·ªÉn (PC):</h3>
            <div class="keyboard-controls">
                <div class="control-item"><strong>‚Üë‚Üì‚Üê‚Üí</strong> - D-Pad</div>
                <div class="control-item"><strong>Z</strong> - N√∫t B</div>
                <div class="control-item"><strong>X</strong> - N√∫t A</div>
                <div class="control-item"><strong>Enter</strong> - Start</div>
                <div class="control-item"><strong>Shift</strong> - Select</div>
                <div class="control-item"><strong>Ctrl+S</strong> - L∆∞u tr·∫°ng th√°i</div>
            </div>
            <p style="margin-top: 15px; font-size: 12px; opacity: 0.8;">
                üí° <strong>L∆∞u √Ω:</strong> B·∫°n c·∫ßn cung c·∫•p file ROM NES c·ªßa ch√≠nh m√¨nh (game ph·∫£i h·ª£p ph√°p ho·∫∑c homebrew).
                H·ªó tr·ª£ ƒë·∫ßu v√†o c·∫£m ·ª©ng tr√™n thi·∫øt b·ªã di ƒë·ªông.
            </p>
        </div>
    </div>

    <!-- Nostalgist.js Library t·ª´ CDN -->
    <script src="https://unpkg.com/nostalgist"></script>

    <script>
        let currentGame = null;
        let isPaused = false;

        // H√†m x·ª≠ l√Ω ph√°t game
        async function handlePlayRom() {
            const romFile = document.getElementById('romFile');
            const romUrl = document.getElementById('romUrl').value;
            const status = document.getElementById('status');
            const container = document.getElementById('nostalgist-container');

            // Ki·ªÉm tra ƒë·∫ßu v√†o
            if (!romFile.files.length && !romUrl) {
                status.textContent = '‚ùå Vui l√≤ng ch·ªçn file ROM ho·∫∑c nh·∫≠p URL';
                return;
            }

            try {
                status.textContent = '‚è≥ ƒêang t·∫£i game...';
                status.className = 'status-message loading';
                disableControls(true);

                let rom;
                if (romFile.files.length > 0) {
                    rom = romFile.files[0];
                } else {
                    rom = romUrl;
                }

                // Kh·ªüi ƒë·ªông tr√≤ ch∆°i NES
                currentGame = await Nostalgist.nes(rom, {
                    element: container,
                    retroarchConfig: {
                        rewind_enable: true,
                        turbo_enable: true,
                    }
                });

                // Hi·ªÉn th·ªã container
                container.style.display = 'block';
                status.style.display = 'none';
                status.className = 'status-message';

                // C·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t
                updateButtonStates(true);

                console.log('‚úÖ Game NES ƒë√£ t·∫£i th√†nh c√¥ng!');
            } catch (error) {
                console.error('L·ªói khi t·∫£i game:', error);
                status.textContent = `‚ùå L·ªói: ${error.message || 'Kh√¥ng th·ªÉ t·∫£i game. Vui l√≤ng ki·ªÉm tra file ROM ho·∫∑c URL.'}`;
                status.className = 'status-message';
                disableControls(false);
            }
        }

        // H√†m t·∫°m d·ª´ng
        async function handlePause() {
            if (currentGame && !isPaused) {
                try {
                    await currentGame.pause?.();
                    isPaused = true;
                    updateButtonStates(true);
                    console.log('‚è∏ Game ƒë√£ ƒë∆∞·ª£c t·∫°m d·ª´ng');
                } catch (error) {
                    console.error('L·ªói khi t·∫°m d·ª´ng:', error);
                }
            }
        }

        // H√†m ti·∫øp t·ª•c
        async function handleResume() {
            if (currentGame && isPaused) {
                try {
                    await currentGame.resume?.();
                    isPaused = false;
                    updateButtonStates(true);
                    console.log('‚ñ∂Ô∏è Game ƒë√£ ti·∫øp t·ª•c');
                } catch (error) {
                    console.error('L·ªói khi ti·∫øp t·ª•c:', error);
                }
            }
        }

        // H√†m d·ª´ng
        async function handleStop() {
            if (currentGame) {
                try {
                    await currentGame.stop?.();
                    currentGame = null;
                    isPaused = false;
                    
                    // ·∫®n emulator
                    document.getElementById('nostalgist-container').style.display = 'none';
                    const status = document.getElementById('status');
                    status.style.display = 'block';
                    status.textContent = 'Ch·ªçn m·ªôt file NES ho·∫∑c nh·∫≠p URL ƒë·ªÉ b·∫Øt ƒë·∫ßu ch∆°i game';
                    
                    updateButtonStates(false);
                    console.log('‚èπ Game ƒë√£ d·ª´ng');
                } catch (error) {
                    console.error('L·ªói khi d·ª´ng:', error);
                }
            }
        }

        // C·∫≠p nh·∫≠t tr·∫°ng th√°i c√°c n√∫t
        function updateButtonStates(isPlaying) {
            const playBtn = document.getElementById('playButton');
            const pauseBtn = document.getElementById('pauseButton');
            const resumeBtn = document.getElementById('resumeButton');
            const stopBtn = document.getElementById('stopButton');

            if (isPlaying) {
                playBtn.disabled = true;
                pauseBtn.disabled = isPaused;
                resumeBtn.disabled = !isPaused;
                stopBtn.disabled = false;
            } else {
                playBtn.disabled = false;
                pauseBtn.disabled = true;
                resumeBtn.disabled = true;
                stopBtn.disabled = true;
            }
        }

        // V√¥ hi·ªáu h√≥a c√°c ƒëi·ªÅu khi·ªÉn
        function disableControls(disable) {
            document.getElementById('romFile').disabled = disable;
            document.getElementById('romUrl').disabled = disable;
            document.getElementById('playButton').disabled = disable && !currentGame;
        }

        // X·ª≠ l√Ω thay ƒë·ªïi file
        document.getElementById('romFile').addEventListener('change', function(e) {
            const romUrl = document.getElementById('romUrl');
            if (e.target.files.length > 0) {
                romUrl.value = '';
            }
        });

        // X·ª≠ l√Ω thay ƒë·ªïi URL
        document.getElementById('romUrl').addEventListener('input', function(e) {
            if (e.target.value) {
                document.getElementById('romFile').value = '';
            }
        });

        // Kh·ªüi t·∫°o tr·∫°ng th√°i n√∫t
        updateButtonStates(false);
    </script>
</body>
</html>
